# Runs CI tasks on pull requests and pushes

name: Continuous Integration

on:
  pull_request:
    branches:
      - dev
      - master
  push:
    branches-ignore:
        # Release workflow will run on master
        - master

jobs:
    lint:
        name: Lint
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            
            - name: Use Node.js 12.x
              uses: actions/setup-node@v1
              with:
                node-version: 12.x

            - name: Cache Node.js modules
              uses: actions/cache@v2
              with:
                path: ~/.npm
                key: ${{ runner.OS }}-node-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                    ${{ runner.OS }}-node-
                    ${{ runner.OS }}-

            - name: Install npm dependencies
              run: npm ci

            - name: Run ESLint on Frontend & Backend
              run: npm run lint
    
    build:
        needs: lint
        name: Build Matrix
        runs-on: [ubuntu-latest, macos-latest, windows-latest]

        steps:
            - name: Checkout
              uses: actions/checkout@v2

            - name: Use Node.js 12.x
              uses: actions/setup-node@v1
              with:
                node-version: 12.x

            - name: Cache Node.js modules
              uses: actions/cache@v2
              with:
                path: ~/.npm
                key: ${{ runner.OS }}-node-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                    ${{ runner.OS }}-node-
                    ${{ runner.OS }}-

            - name: Install npm dependencies
              run: npm ci

            - name: Build Linux
              if: runner.os == 'Linux'
              run: npm run dist -- -l

            - name: Build Mac
              if: runner.os == 'macOS'
              run: npm run dist -- -m

            - name: Build Windows
              if: runner.os == 'windows'
              shell: bash
              run: npm run dist -- -w